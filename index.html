<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlareGPT – 100% w przeglądarce</title>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@mlc-ai/web-llm@0.2.47"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background:#000; color:#fff; height:100vh; overflow:hidden; }
        .container { display:flex; flex-direction:column; height:100vh; }
        .header { background:#1a1a1a; padding:15px 30px; text-align:center; font-size:20px; border-bottom:1px solid #333; }
        .chat { flex:1; overflow-y:auto; padding:20px; display:flex; flex-direction:column; gap:15px; }
        .msg { max-width:80%; padding:12px 18px; border-radius:12px; line-height:1.5; }
        .user { align-self:flex-end; background:#2d2d2d; }
        .ai { align-self:flex-start; background:#1e1e1e; }
        .inputarea { padding:15px; background:#000; border-top:1px solid #333; }
        textarea { width:100%; background:#111; color:#fff; border:none; padding:15px; border-radius:12px; font-size:16px; resize:none; }
        button { position:absolute; right:25px; top:50%; transform:translateY(-50%); background:none; border:none; color:#888; cursor:pointer; font-size:20px; }
        .status { text-align:center; padding:10px; color:#0f0; font-size:14px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">FlareGPT – Qwen2.5-7B (działa w Twojej przeglądarce)</div>
        <div id="chat" class="chat"></div>
        <div class="status" id="status">Ładowanie modelu… (pierwszy raz ~30–90 sekund)</div>
        <div class="inputarea" style="position:relative">
            <textarea id="input" rows="1" placeholder="Wpisz wiadomość…"></textarea>
            <button onclick="send()">↑</button>
        </div>
    </div>

<script type="module">
    import { CreateMLCEngine } from "https://cdn.jsdelivr.net/npm/@mlc-ai/web-llm@0.2.47";

    const chat = document.getElementById("chat");
    const input = document.getElementById("input");
    const status = document.getElementById("status");
    let engine;

    const modelId = "Qwen2.5-7B-Instruct-q4f16_1-MLC"; // najszybszy i najmocniejszy w przeglądarce

    async function init() {
        status.textContent = "Pobieranie modelu… (tylko raz)";
        engine = await CreateMLCEngine(modelId, {
            initProgressCallback: (report) => {
                status.textContent = `Ładowanie: ${(report.progress*100).toFixed(0)}%`;
            }
        });
        status.textContent = "Gotowy! Możesz pisać.";
    }

    async function send() {
        if (!engine || input.value.trim() === "") return;
        const msg = input.value.trim();
        input.value = "";

        chat.innerHTML += `<div class="msg user">${msg}</div>`;
        chat.scrollTop = chat.scrollHeight;

        const reply = await engine.chat.completions.create({
            messages: [{ role: "user", content: msg }],
            temperature: 0.7
        });

        chat.innerHTML += `<div class="msg ai">${reply.choices[0].message.content}</div>`;
        chat.scrollTop = chat.scrollHeight;
    }

    input.addEventListener("keypress", e => { if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); send(); } });

    init();
</script>
</body>
</html>
